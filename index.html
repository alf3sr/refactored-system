<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Point¬†Tracker</title>

<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#000000">
<link rel="apple-touch-icon" href="./Icon-192.png">

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
:root{--bg:#000;--panel-bg:#111;--panel-border:#333;--text:#fff;--accent:#3498db;
      --pill-bg:#181818;--pill-br:#444;--pill-fg:#fff;--box:#000;--gap:2px}
@media (prefers-color-scheme:light){
  :root{--bg:#fff;--panel-bg:#f5f5f5;--panel-border:#ccc;--text:#000;--accent:#156fd1;
        --pill-bg:#eee;--pill-br:#bbb;--pill-fg:#000;--box:#fff}
}
.light{--bg:#fff;--panel-bg:#f5f5f5;--panel-border:#ccc;--text:#000;--box:#fff}
.dark {--bg:#000;--panel-bg:#111;--panel-border:#333;--text:#fff;--box:#000}

*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
body{height:100vh;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif;
     overflow:hidden;touch-action:manipulation;user-select:none;-webkit-user-select:none}
button{font:inherit}
.pill{padding:.45rem .9rem;border-radius:20px;background:var(--pill-bg);border:1px solid var(--pill-br);color:var(--pill-fg);cursor:pointer}
.pill:active{background:#222}

#settingsBtn{position:fixed;top:1rem;right:1rem;z-index:90;width:2.6rem;height:2.6rem;display:flex;align-items:center;justify-content:center}
#cornerBtns{position:fixed;bottom:1rem;left:1rem;z-index:90;display:flex;gap:.7rem}
#timerBtn{position:fixed;bottom:1rem;right:1rem;z-index:90}
body.panel-open #cornerBtns,body.panel-open #timerBtn{opacity:.1;pointer-events:none}

#settingsPanel{position:fixed;top:0;right:0;width:340px;height:100%;
  background:var(--panel-bg);border-left:1px solid var(--panel-border);
  transform:translateX(100%);transition:.3s;padding:1rem;overflow-y:auto;z-index:80;scroll-behavior:smooth}
#settingsPanel.open{transform:translateX(0)}
#settingsPanel h2{margin-bottom:.7rem;font-size:1.2rem;border-bottom:1px solid var(--panel-border);padding-bottom:.4rem}

#preview{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.3rem;margin-bottom:.8rem}
.previewBox{padding:.4rem;text-align:center;font-size:.85rem;border-radius:6px;background:var(--box);border:1px solid var(--panel-border)}
.previewBox span{display:block;font-weight:600}

label.row{display:flex;align-items:center;margin:.55rem 0;font-size:.93rem}
label.row>span{flex:1}
.row input[type="text"],.row select{flex:1;padding:.35rem .55rem;background:#1a1a1a;border:1px solid #444;border-radius:6px;color:var(--text)}
.light .row input[type="text"],.light .row select{background:#fff;border:1px solid #bbb;color:#000}
.row input[type="color"]{width:2rem;height:2rem;padding:0;border:none;background:none}

.swatchWrap{display:flex;gap:.25rem;margin-top:.25rem}
.swatch{width:1.2rem;height:1.2rem;border-radius:50%;border:1px solid #666;cursor:pointer}

.toggle{position:relative;width:48px;height:27px;margin-left:.6rem}
.toggle input{opacity:0;width:0;height:0}
.slider{position:absolute;inset:0;background:#444;border-radius:27px;transition:.25s}
.slider:before{content:"";position:absolute;left:3px;top:3px;width:21px;height:21px;border-radius:50%;background:#fff;transition:.25s}
input:checked+.slider{background:var(--accent)}
input:checked+.slider:before{transform:translateX(21px)}

.rangeRow{display:flex;align-items:center;gap:.6rem;font-size:.9rem}
.rangeRow input[type=range]{flex:1;-webkit-appearance:none;background:transparent}
input[type=range]::-webkit-slider-runnable-track{height:4px;background:#444;border-radius:4px}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:22px;height:22px;border-radius:50%;background:var(--accent);margin-top:-9px;box-shadow:0 0 2px rgba(0,0,0,.6)}
input[type=range]:focus{outline:none}

.statsBox{margin-top:1rem;border-top:1px solid var(--panel-border);padding-top:.8rem;font-size:.9rem}
.statsBox h3{font-size:1rem;margin-bottom:.5rem}

#court{position:absolute;inset:0;display:grid;gap:var(--gap)}
.teamBox{background:var(--box);display:flex;flex-direction:column;justify-content:center;align-items:center;cursor:pointer;padding:.4rem;transition:background .15s,transform .13s}
.teamBox:active{transform:scale(.96)}
.teamName{font-size:clamp(4rem,10vw,6rem);font-family:'Bebas Neue',sans-serif}
.teamScore{font-size:clamp(8rem,20vmin,16rem);font-family:'Bebas Neue',sans-serif;transition:transform .25s}
.pop{transform:scale(1.35)}
.leader{box-shadow:0 0 10px 4px currentColor inset}

#winnerBanner{position:absolute;inset:0;display:none;background:rgba(0,0,0,.8);z-index:95;color:#fff;font-size:2.4rem;font-weight:700;
              justify-content:center;align-items:center;flex-direction:column;text-align:center}
#winnerBanner button{margin-top:1rem}

#matchTimer{position:fixed;top:1rem;left:50%;transform:translateX(-50%);font-size:1.2rem;font-family:'Bebas Neue',sans-serif;letter-spacing:.5px;z-index:89}
body.panel-open #matchTimer{opacity:0}
</style>
</head>
<body class="dark">

<div id="matchTimer">00:00</div>

<button id="settingsBtn" class="pill">‚öôÔ∏è</button>
<div id="cornerBtns"><button id="undoBtn" class="pill">Undo</button><button id="resetBtn" class="pill">Reset</button></div>
<button id="timerBtn" class="pill">‚èµ¬†Timer</button>

<div id="settingsPanel">
  <h2>Settings</h2>
  <div id="preview"></div>

  <label class="row"><span>Teams</span>
    <select id="teamCount"><option>2</option><option>3</option><option>4</option></select>
  </label>
  <div id="teamsConfig"></div>

  <label class="row"><span>Points¬†/¬†tap</span><select id="stepSel"><option>1</option><option>2</option><option>3</option><option>5</option></select></label>

  <label class="row"><span>Score¬†limit</span>
    <div class="toggle"><input type="checkbox" id="limitToggle"><span class="slider"></span></div>
  </label>
  <div id="limitRow" class="rangeRow hidden"><input type="range" id="limitRange" min="1" max="100"><span id="limitVal"></span></div>

  <label class="row"><span>Countdown¬†timer</span>
    <div class="toggle"><input type="checkbox" id="cdToggle"><span class="slider"></span></div>
  </label>
  <div id="cdRow" class="rangeRow hidden"><input type="range" id="cdRange" min="1" max="60"><span id="cdVal"></span></div>

  <label class="row"><span>Theme</span>
    <select id="themeSel"><option value="auto">Auto</option><option value="dark">Dark</option><option value="light">Light</option></select>
  </label>

  <div class="statsBox"><h3>Stats</h3><div id="statsWrap"></div><button id="resetStats" class="pill" style="margin-top:.6rem;display:none">Reset¬†stats</button></div>
</div>

<div id="court"></div>
<div id="winnerBanner"><div id="winnerText">üèÜ¬†Winner!</div><button onclick="resetGame()" class="pill">New¬†game</button></div>

<script>
const $=id=>document.getElementById(id);
const swatches=['#3498db','#e74c3c','#9b59b6','#f1c40f','#1abc9c','#fff','#000'];
const fmt=ms=>{const s=Math.floor(ms/1000),m=Math.floor(s/60),ss=String(s%60).padStart(2,'0');return`${m}:${ss}`};
const seed={teamCount:2,teams:[{name:'Team¬†A',color:'#3498db',score:0},{name:'Team¬†B',color:'#e74c3c',score:0}],
            step:1,limitEnabled:false,limit:11,countdownEnabled:false,countdown:300000,
            timer:{running:false,start:0,elapsed:0},history:[],wins:{},games:0,pointsTotal:0,theme:'auto'};
let cfg=Object.assign(seed,JSON.parse(localStorage.getItem('pt-state')||'{}'));
function save(){localStorage.setItem('pt-state',JSON.stringify(cfg))}
const els={panel:$('settingsPanel'),gear:$('settingsBtn'),preview:$('preview'),
  teamCount:$('teamCount'),teams:$('teamsConfig'),stepSel:$('stepSel'),
  limitToggle:$('limitToggle'),limitRow:$('limitRow'),limitRange:$('limitRange'),limitVal:$('limitVal'),
  cdToggle:$('cdToggle'),cdRow:$('cdRow'),cdRange:$('cdRange'),cdVal:$('cdVal'),
  themeSel:$('themeSel'),court:$('court'),undo:$('undoBtn'),reset:$('resetBtn'),
  timerBtn:$('timerBtn'),timerDisp:$('matchTimer'),winner:$('winnerBanner'),winnerText:$('winnerText'),
  stats:$('statsWrap'),resetStats:$('resetStats')};

els.gear.addEventListener('click',()=>{els.panel.classList.toggle('open');document.body.classList.toggle('panel-open',els.panel.classList.contains('open'))});

function applyTheme(){const sys=matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light';document.body.classList.toggle('light',cfg.theme==='light'||(cfg.theme==='auto'&&sys==='light'));document.body.classList.toggle('dark',cfg.theme!=='light'&&(cfg.theme!=='auto'||sys==='dark'));els.themeSel.value=cfg.theme;}
els.themeSel.oninput=e=>{cfg.theme=e.target.value;applyTheme();save()};applyTheme();

/* ---- teams ---- */
function renderTeams(){
  cfg.teams = Array.from({length: cfg.teamCount}, (_,i)=>{
    const prev=cfg.teams[i]||{};
    return {
      name : prev.name  || `Team ${String.fromCharCode(65+i)}`,
      color: prev.color || swatches[i%swatches.length],
      score: prev.score || 0
    };
  });

  els.teams.innerHTML='';
  cfg.teams.forEach((t,i)=>{
    els.teams.insertAdjacentHTML('beforeend',`
      <label class="row"><span>Team ${String.fromCharCode(65+i)}</span><input type="text" id="name${i}" value="${t.name}"></label>
      <label class="row"><span style="visibility:hidden">Colour</span><input type="color" id="clr${i}" value="${t.color}"></label>
      <div class="swatchWrap" id="sw${i}"></div>
    `);
    swatches.forEach(c=>{const d=document.createElement('div');d.className='swatch';d.style.background=c;d.onclick=()=>$(`clr${i}`).value=c, cfg.teams[i].color=c,updateCourt(),updatePreview(),save();$(`sw${i}`).append(d);});
  });
  updateCourt();updatePreview();save();
}
['change','input'].forEach(evt=>els.teamCount.addEventListener(evt,e=>{cfg.teamCount=+e.target.value;renderTeams()}));

els.teams.addEventListener('input',e=>{
  const m=e.target.id.match(/(name|clr)(\d+)/);if(!m)return;
  const i=+m[2];
  if(m[1]==='name')cfg.teams[i].name=e.target.value||`Team ${String.fromCharCode(65+i)}`;
  else cfg.teams[i].color=e.target.value;
  updateCourt();updatePreview();save();
});

/* points / tap */
els.stepSel.value=cfg.step;els.stepSel.onchange=e=>{cfg.step=+e.target.value;save()}

/* limit */
function syncLimit(){els.limitRow.classList.toggle('hidden',!els.limitToggle.checked);cfg.limitEnabled=els.limitToggle.checked;save()}
els.limitToggle.checked=cfg.limitEnabled;els.limitToggle.onchange=syncLimit;
els.limitRange.value=cfg.limit;els.limitVal.textContent=cfg.limit;
els.limitRange.oninput=e=>{cfg.limit=+e.target.value;els.limitVal.textContent=e.target.value;save()}
syncLimit();

/* countdown */
function syncCD(){els.cdRow.classList.toggle('hidden',!els.cdToggle.checked);cfg.countdownEnabled=els.cdToggle.checked;resetClock();save()}
els.cdToggle.checked=cfg.countdownEnabled;els.cdToggle.onchange=syncCD;
els.cdRange.value=cfg.countdown/60000;els.cdVal.textContent=cfg.countdown/60000;
els.cdRange.oninput=e=>{cfg.countdown=+e.target.value*60000;els.cdVal.textContent=e.target.value;resetClock();save()}
syncCD();

/* preview */
function updatePreview(){els.preview.innerHTML='';cfg.teams.forEach(t=>els.preview.insertAdjacentHTML('beforeend',`<div class="previewBox"><span style="color:${t.color}">${t.name}</span><small style="color:${t.color}">0</small></div>`))}

/* court */
function updateCourt(){els.court.style.gridTemplate=cfg.teamCount===2?'1fr 1fr / 1fr':'1fr 1fr / 1fr 1fr';els.court.innerHTML='';cfg.teams.forEach((t,i)=>{const b=document.createElement('div');b.className='teamBox';b.dataset.i=i;b.innerHTML=`<div class="teamName" style="color:${t.color}">${t.name}</div><div class="teamScore" style="color:${t.color}">${t.score}</div>`;b.addEventListener('pointerdown',e=>startPress(e,b));els.court.append(b);});updateScores();highlight();}

/* score display */
function updateScores(){document.querySelectorAll('.teamScore').forEach((el,i)=>el.textContent=cfg.teams[i].score)}
function highlight(){const mx=Math.max(...cfg.teams.map(t=>t.score));document.querySelectorAll('.teamBox').forEach((b,i)=>b.classList.toggle('leader',cfg.teams[i].score===mx&&mx>0))}

/* press */
let longId,wasLong=false;
function startPress(e,b){const i=+b.dataset.i,s=cfg.step;wasLong=false;longId=setTimeout(()=>{change(i,-s);wasLong=true},500);const end=()=>{clearTimeout(longId);if(!wasLong)change(i,s);b.removeEventListener('pointerup',end);b.removeEventListener('pointercancel',end)};b.addEventListener('pointerup',end);b.addEventListener('pointercancel',end)}
function pop(b,c){const sc=b.querySelector('.teamScore');sc.classList.add('pop');setTimeout(()=>sc.classList.remove('pop'),250);b.animate([{background:c+'22'},{background:'transparent'}],{duration:250})}
function change(i,d){cfg.teams[i].score=Math.max(0,cfg.teams[i].score+d);cfg.history.push({team:i,delta:d});if(cfg.history.length>300)cfg.history.shift();updateScores();pop(els.court.children[i],cfg.teams[i].color);highlight();haptic();win(i);save();}

/* undo / reset */
els.undo.onclick=()=>{const h=cfg.history.pop();if(!h)return;cfg.teams[h.team].score=Math.max(0,cfg.teams[h.team].score-h.delta);updateScores();highlight();save()}
function resetGame(){cfg.teams.forEach(t=>t.score=0);cfg.history=[];updateScores();highlight();els.winner.style.display='none';save()}
els.reset.onclick=resetGame;

/* winner */
function win(i){if(cfg.limitEnabled&&cfg.teams[i].score>=cfg.limit){confetti({particleCount:200,spread:70,startVelocity:45});els.winnerText.textContent=`üèÜ¬†${cfg.teams[i].name} wins!`;els.winner.style.display='flex';cfg.wins[cfg.teams[i].name]=(cfg.wins[cfg.teams[i].name]||0)+1;cfg.games++;cfg.pointsTotal+=cfg.teams.reduce((s,t)=>s+t.score,0);stats();}}
function stats(){els.stats.innerHTML='';Object.entries(cfg.wins).forEach(([n,w])=>els.stats.insertAdjacentHTML('beforeend',`<div>${n}:¬†${w}</div>`));if(cfg.games){els.stats.insertAdjacentHTML('beforeend',`<div>Avg pts/game:¬†${(cfg.pointsTotal/cfg.games).toFixed(1)}</div>`);els.resetStats.style.display='';}else els.resetStats.style.display='none';}
els.resetStats.onclick=()=>{cfg.wins={};cfg.games=cfg.pointsTotal=0;stats();save()};stats();

/* countdown */
function resetClock(){if(!cfg.countdownEnabled){els.timerDisp.textContent='00:00';els.timerBtn.style.display='none';return}els.timerBtn.style.display='';cfg.timer.elapsed=cfg.countdown;cfg.timer.running=false;els.timerBtn.textContent='‚èµ¬†Timer';}
resetClock();
els.timerBtn.onclick=()=>{if(!cfg.countdownEnabled)return;const t=cfg.timer;if(t.running){t.running=false;t.elapsed=Math.max(0,t.start+cfg.countdown-Date.now());els.timerBtn.textContent='‚èµ¬†Timer'}else{t.running=true;t.start=Date.now()-(cfg.countdown-t.elapsed||0);els.timerBtn.textContent='‚è∏¬†Timer'}save()};
(function loop(){const t=cfg.timer;if(t.running&&cfg.countdownEnabled){const r=Math.max(0,t.start+cfg.countdown-Date.now());els.timerDisp.textContent=fmt(r);if(r===0){t.running=false;confetti({particleCount:180,spread:100})}}requestAnimationFrame(loop)})();

/* haptic */
let audioCtx;function haptic(){try{audioCtx=audioCtx||new(AudioContext||webkitAudioContext)();const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.frequency.value=200;g.gain.value=.8;o.start();o.stop(audioCtx.currentTime+.02)}catch{}}

/* dbl‚Äëtap zoom */
let last=0;document.addEventListener('touchend',e=>{const n=e.timeStamp;if(n-last<300)e.preventDefault();last=n},{passive:false});

renderTeams();applyTheme();
if('serviceWorker'in navigator){navigator.serviceWorker.register('./sw.js').catch(console.error)}
</script>
</body></html>
